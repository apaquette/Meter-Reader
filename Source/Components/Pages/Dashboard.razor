@* @using EnergyInsightHub.Data
@using EnergyInsightHub.Models*@
@using EnergyInsightHub.Services

@page "/"
@rendermode InteractiveServer

@inject DashboardUpdater DashboardUpdater

<PageTitle>Dashboard</PageTitle>

<RadzenHeader>
    <RadzenText Text="Energy Insight Hub" TextStyle="TextStyle.DisplayH1" Style="color: white;" />
</RadzenHeader>

<RadzenRow Style="margin-top: 150px;">
    <RadzenButton Text="Reset" Click="ResetDatabase" />
    <RadzenButton Text="Start Transmission" Click="TransmissionService.TransmitImages" />
</RadzenRow>

<RadzenRow>
    <RadzenColumn>
        <RadzenText Text="Hourly Consumption" TextStyle="TextStyle.DisplayH5" />
        <RadzenChart>
            <RadzenLineSeries Data=@Intervals CategoryProperty="YAxisData" Title="Hourly Consumption" ValueProperty="XAxisData">
                <ChildContent>
                    <RadzenMarkers MarkerType="MarkerType.Circle" />
                </ChildContent>
                <TooltipTemplate>
                    <b>Date:</b> @context.YAxisData.ToString("dd/MM/yyyy")
                    <br />
                    <b>Time:</b> @context.YAxisData.ToString("HH:mm")
                    <br />
                    <b>Interval:</b> @context.XAxisData kwh
                </TooltipTemplate>
            </RadzenLineSeries>
            <RadzenLegend Visible=false />
            <RadzenValueAxis Step="1">
                <RadzenGridLines Visible="true" />
                <RadzenAxisTitle Text="Hourly consumption (kwh)" />
            </RadzenValueAxis>
            <RadzenCategoryAxis Formatter=@(value => (((DateTime)value).ToString("HH:mm"))) Step="StepValue" />
        </RadzenChart>
    </RadzenColumn>
    <RadzenColumn>
        <RadzenText Text="Total Consumption" TextStyle="TextStyle.DisplayH5" />
        <RadzenChart>
            <RadzenColumnSeries Data=@ChartColumns CategoryProperty="YAxisData" Title="Reading" ValueProperty="XAxisData">
                <TooltipTemplate>
                    <b>Date:</b> @context.YAxisData.ToString("dd/MM/yyyy")
                    <br />
                    <b>Time:</b> @context.YAxisData.ToString("HH:mm")
                    <br />
                    <b>Reading:</b> @context.XAxisData kwh
                </TooltipTemplate>
            </RadzenColumnSeries>

            <RadzenLegend Visible=false />
            <RadzenColumnOptions Radius="5" Width="20" />
            <RadzenValueAxis>
                <RadzenGridLines Visible="true" />
                <RadzenAxisTitle Text="Total consumption (kwh)" />
            </RadzenValueAxis>
            <RadzenCategoryAxis Formatter=@(value => (((DateTime)value).ToString("HH:mm"))) Step="StepValue" />
        </RadzenChart>
    </RadzenColumn>
</RadzenRow>

<RadzenText Text="Raw Data" TextStyle="TextStyle.DisplayH5" />
<RadzenDataGrid Data="@GridRows" TItem="Row" AllowPaging PagerHorizontalAlign="HorizontalAlign.Center" Density="Density.Compact" GridLines="DataGridGridLines.Horizontal" EmptyText="No Readings to show.">
    <Columns>
        <RadzenDataGridColumn TItem="Row" Property="Date" Title="Date" Width="120px">
            <Template Context="data">
                @data.Date.ToString("yyyy-MM-dd")
            </Template>
        </RadzenDataGridColumn>
        @for (int x = 0; x < 24; ++x)
        {
            DateTime time = new();
            int index = x;
            <RadzenDataGridColumn TItem="Row" Title="@((time.AddHours(x) - time).ToString(@"hh\:mm"))">
                <Template Context="data">
                    @if(data.Readings[index] is null)
                    {
                        @("-")
                    }
                    @data.Readings[index]?.Amount
                </Template>
            </RadzenDataGridColumn>
        }
        <RadzenDataGridColumn TItem="Row" Title="Total" Property="Total" Width="80px" />
    </Columns>
</RadzenDataGrid>